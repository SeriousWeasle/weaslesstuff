ACTOR PlasmaCannonSpinUp : Inventory
{
    Inventory.MaxAmount 1
}

ACTOR PlasmaCannonCellsLoaded : Inventory
{
    Inventory.MaxAmount 1
}

ACTOR PlasmaCannonSolariumLoaded : Inventory
{
    Inventory.MaxAmount 1
}

ACTOR PlasmaCannonLunariumLoaded : Inventory
{
    Inventory.MaxAmount 1
}

ACTOR PlasmaCannon : DoomWeapon
{
    Weapon.SlotNumber 7
    Weapon.AmmoGive1 200
    Weapon.AmmoType1 "LunariumCell"
    Weapon.AmmoGive2 200
    Weapon.AmmoType2 "SolariumCell"
    Inventory.PickupMessage "Got the Plasma Cannon"
    States
    {
        Ready:
            REPG A 1 A_WeaponReady (WRF_ALLOWRELOAD|WRF_ALLOWZOOM)
            Loop
        Select:
            REPG A 1 A_Raise
            Loop
        Deselect:
            REPG A 1 A_Lower
            Loop
        Reload:
            TNT1 A 0 A_JumpIfInventory("PlasmaCannonLunariumLoaded", 1, "LoadSolarium")
        CheckSolarium:
            TNT1 A 0 A_JumpIfInventory("PlasmaCannonSolariumLoaded", 1, "LoadCell")
        CheckCells:
            TNT1 A 0 A_JumpIfInventory("PlasmaCannonCellsLoaded", 1, "LoadLunarium")
        LoadLunarium:
            REPG A 4
            {
                A_TakeInventory("PlasmaCannonCellsLoaded", 1);
                A_PlaySound("EnergyPistol/Switch", 0);
            }
            REPG A 4 A_GiveInventory("PlasmaCannonLunariumLoaded", 1)
            Goto Ready
        LoadSolarium:
            REPG A 4
            {
                A_TakeInventory("PlasmaCannonLunariumLoaded", 1);
                A_PlaySound("EnergyPistol/Switch", 0);
            }
            REPG A 4 A_GiveInventory("PlasmaCannonSolariumLoaded", 1)
            Goto Ready
        LoadCell:
            REPG A 4
            {
                A_TakeInventory("PlasmaCannonSolariumLoaded", 1);
                A_PlaySound("EnergyPistol/Switch", 0);
            }
            REPG A 4 A_GiveInventory("PlasmaCannonCellsLoaded", 1)
            Goto Ready
        AltFire:
            REPG A 0 A_JumpIfInventory("PlasmaCannonSpinUp", 1, "AltAmmoTypeCheck")
            REPG A 0 A_PlaySound("PlasmaCannon/SpinUp", 0)
            REPG AAAA 1
            REPG BBB 1
            REPG CCC 1
            REPG DD 1 A_GiveInventory("PlasmaCannonSpinUp", 1)
        AltAmmoTypeCheck:
            TNT1 A 0 A_JumpIfInventory("PlasmaCannonCellsLoaded", 1, "AmmoCheckCells")
        FireCheckLunarium:
            TNT1 A 0 A_JumpIfInventory("PlasmaCannonLunariumLoaded", 1, "AmmoCheckLunarium")
        FireCheckSolarium:
            TNT1 A 0 A_JumpIfInventory("PlasmaCannonSolariumLoaded", 1, "AmmoCheckSolarium")
        AmmoCheckCells:
            TNT1 A 0 A_JumpIfInventory("Cell", 12, "FireCells")
            Goto Ready
        AmmoCheckLunarium:
            TNT1 A 0 A_JumpIfInventory("LunariumCell", 12, "FireLunarium")
            Goto Ready
        AmmoCheckSolarium:
            TNT1 A 0 A_JumpIfInventory("SolariumCell", 12, "FireSolarium")
            Goto Ready
        FireCells:
            REPG E 2
            {
                A_FireProjectile("EnergyPistolCellBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolCellBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolCellBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_TakeInventory("Cell", 3);
                A_PlaySound("EnergyPistol/Fire", 0);
            }
            REPG F 2
            {
                A_FireProjectile("EnergyPistolCellBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolCellBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolCellBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_TakeInventory("Cell", 3);
                A_PlaySound("EnergyPistol/Fire", 0);
            }
            REPG G 2
            {
                A_FireProjectile("EnergyPistolCellBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolCellBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolCellBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_TakeInventory("Cell", 3);
                A_PlaySound("EnergyPistol/Fire", 0);
            }
            REPG H 2
            {
                A_FireProjectile("EnergyPistolCellBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolCellBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolCellBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_TakeInventory("Cell", 3);
                A_PlaySound("EnergyPistol/Fire", 0);
            }
            REPG A 0 A_ReFire
            Goto SpinDown
        FireLunarium:
            REPG E 2
            {
                A_FireProjectile("EnergyPistolLunariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolLunariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolLunariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_TakeInventory("LunariumCell", 3);
                A_PlaySound("EnergyPistol/Fire", 0);
            }
            REPG F 2
            {
                A_FireProjectile("EnergyPistolLunariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolLunariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolLunariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_TakeInventory("LunariumCell", 3);
                A_PlaySound("EnergyPistol/Fire", 0);
            }
            REPG G 2
            {
                A_FireProjectile("EnergyPistolLunariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolLunariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolLunariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_TakeInventory("LunariumCell", 3);
                A_PlaySound("EnergyPistol/Fire", 0);
            }
            REPG H 2
            {
                A_FireProjectile("EnergyPistolLunariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolLunariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolLunariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_TakeInventory("LunariumCell", 3);
                A_PlaySound("EnergyPistol/Fire", 0);
            }
            REPG A 0 A_ReFire
            Goto SpinDown
        FireSolarium:
            REPG E 2
            {
                A_FireProjectile("EnergyPistolSolariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolSolariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolSolariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_TakeInventory("SolariumCell", 3);
                A_PlaySound("EnergyPistol/Fire", 0);
            }
            REPG F 2
            {
                A_FireProjectile("EnergyPistolSolariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolSolariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolSolariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_TakeInventory("SolariumCell", 3);
                A_PlaySound("EnergyPistol/Fire", 0);
            }
            REPG G 2
            {
                A_FireProjectile("EnergyPistolSolariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolSolariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolSolariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_TakeInventory("SolariumCell", 3);
                A_PlaySound("EnergyPistol/Fire", 0);
            }
            REPG H 2
            {
                A_FireProjectile("EnergyPistolSolariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolSolariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_FireProjectile("EnergyPistolSolariumBall", random(-5,5), 0, 0, 0, 0, random(-5,5));
                A_TakeInventory("SolariumCell", 3);
                A_PlaySound("EnergyPistol/Fire", 0);
            }
            REPG A 0 A_ReFire
            Goto SpinDown
        Fire:
            REPG A 0 A_JumpIfInventory("PlasmaCannonSpinUp", 1, "AmmoTypeCheck")
            REPG A 0 A_PlaySound("PlasmaCannon/SpinUp", 0)
            REPG AAAA 1
            REPG BBB 1
            REPG CCC 1
            REPG DD 1 A_GiveInventory("PlasmaCannonSpinUp", 1)
        AmmoTypeCheck:
            TNT1 A 0 A_JumpIfInventory("PlasmaCannonCellsLoaded", 1, "AltAmmoCheckCells")
        AltFireCheckLunarium:
            TNT1 A 0 A_JumpIfInventory("PlasmaCannonLunariumLoaded", 1, "AltAmmoCheckLunarium")
        AltFireCheckSolarium:
            TNT1 A 0 A_JumpIfInventory("PlasmaCannonSolariumLoaded", 1, "AltAmmoCheckSolarium")
        AltAmmoCheckCells:
            TNT1 A 0 A_JumpIfInventory("Cell", 4, "AltFireCells")
            Goto Ready
        AltAmmoCheckLunarium:
            TNT1 A 0 A_JumpIfInventory("LunariumCell", 4, "AltFireLunarium")
            Goto Ready
        AltAmmoCheckSolarium:
            TNT1 A 0 A_JumpIfInventory("SolariumCell", 4, "AltFireSolarium")
            Goto Ready
        AltFireCells:
            REPG E 1
            {
                A_FireProjectile("PlasmaCannonCellBeam", random(-1,1), 0, 0, 0, 0, random(-1,1));
                A_TakeInventory("Cell", 1);
                A_PlaySound("PlasmaCannon/Fire", 0);
            }
            REPG F 1
            {
                A_FireProjectile("PlasmaCannonCellBeam", random(-1,1), 0, 0, 0, 0, random(-1,1));
                A_TakeInventory("Cell", 1);
            }
            REPG G 1
            {
                A_FireProjectile("PlasmaCannonCellBeam", random(-1,1), 0, 0, 0, 0, random(-1,1));
                A_TakeInventory("Cell", 1);
                A_PlaySound("PlasmaCannon/Fire", 0);
            }
            REPG H 1
            {
                A_FireProjectile("PlasmaCannonCellBeam", random(-1,1), 0, 0, 0, 0, random(-1,1));
                A_TakeInventory("Cell", 1);
            }
            REPG A 0 A_ReFire
            Goto SpinDown
        AltFireLunarium:
            REPG E 1
            {
                A_FireProjectile("PlasmaCannonLunariumBeam", random(-1,1), 0, 0, 0, 0, random(-1,1));
                A_TakeInventory("LunariumCell", 1);
                A_PlaySound("PlasmaCannon/Fire", 0);
            }
            REPG F 1
            {
                A_FireProjectile("PlasmaCannonLunariumBeam", random(-1,1), 0, 0, 0, 0, random(-1,1));
                A_TakeInventory("LunariumCell", 1);
            }
            REPG G 1
            {
                A_FireProjectile("PlasmaCannonLunariumBeam", random(-1,1), 0, 0, 0, 0, random(-1,1));
                A_TakeInventory("LunariumCell", 1);
                A_PlaySound("PlasmaCannon/Fire", 0);
            }
            REPG H 1
            {
                A_FireProjectile("PlasmaCannonLunariumBeam", random(-1,1), 0, 0, 0, 0, random(-1,1));
                A_TakeInventory("LunariumCell", 1);
            }
            REPG A 0 A_ReFire
            Goto SpinDown
        AltFireSolarium:
            REPG E 1
            {
                A_FireProjectile("PlasmaCannonSolariumBeam", random(-1,1), 0, 0, 0, 0, random(-1,1));
                A_TakeInventory("SolariumCell", 1);
                A_PlaySound("PlasmaCannon/Fire", 0);
            }
            REPG F 1
            {
                A_FireProjectile("PlasmaCannonSolariumBeam", random(-1,1), 0, 0, 0, 0, random(-1,1));
                A_TakeInventory("SolariumCell", 1);
            }
            REPG G 1
            {
                A_FireProjectile("PlasmaCannonSolariumBeam", random(-1,1), 0, 0, 0, 0, random(-1,1));
                A_TakeInventory("SolariumCell", 1);
                A_PlaySound("PlasmaCannon/Fire", 0);
            }
            REPG H 1
            {
                A_FireProjectile("PlasmaCannonSolariumBeam", random(-1,1), 0, 0, 0, 0, random(-1,1));
                A_TakeInventory("SolariumCell", 1);
            }
            REPG A 0 A_ReFire
            Goto SpinDown
        SpinDown:
            REPG A 0 A_PlaySound("PlasmaCannon/SpinDown", 5)
            REPG A 1
            REPG B 1
            REPG C 1
            REPG D 1
            REPG AA 1
            REPG BB 1
            REPG CC 1
            REPG DDD 1
            REPG AAA 1
            REPG BBB 1
            REPG CCC 1
            REPG DDDD 1 A_TakeInventory("PlasmaCannonSpinUp", 1)
            REPG D 0
            Goto Ready
        Spawn:
            REPG I -1
            Stop
    }
}

ACTOR PlasmaCannonBeamInheritor
{
    Radius 2
    Height 2
    SeeSound ""
    DeathSound "EnergyPistol/Hit"
    RenderStyle Add
    Projectile
    Scale 1.5
    Alpha 0.75
}

ACTOR PlasmaCannonCellBeam : PlasmaCannonBeamInheritor
{
    Speed 60
    Damage 2
    States
    {
        Spawn:
            ENBG B 4 Bright
            ENBG B 1 Bright A_SpawnItemEx("PlasmaCannonCellBeamTrail", 0, 0, 0, 0, 0, 0, 0)
            Loop
        Death:
            ENBG EFGH 3 Bright
        FadeOut:
            ENBG I 2 Bright A_FadeOut(0.1)
            Loop
    }
}

ACTOR PlasmaCannonLunariumBeam : PlasmaCannonBeamInheritor
{
    Speed 70
    Damage 1
    States
    {
        Spawn:
            ENBB B 4 Bright
            ENBB B 1 Bright A_SpawnItemEx("PlasmaCannonLunariumBeamTrail", 0, 0, 0, 0, 0, 0, 0)
            Loop
        Death:
            ENBB EFGH 3 Bright
        FadeOut:
            ENBB I 2 Bright A_FadeOut(0.1)
            Loop
    }
}

ACTOR PlasmaCannonSolariumBeam : PlasmaCannonBeamInheritor
{
    Speed 50
    Damage 3
    States
    {
        Spawn:
            ENBR B 4 Bright
            ENBR B 1 Bright A_SpawnItemEx("PlasmaCannonSolariumBeamTrail", 0, 0, 0, 0, 0, 0, 0)
            Loop
        Death:
            ENBR EFGH 3 Bright
        FadeOut:
            ENBR I 2 Bright A_FadeOut(0.1)
            Loop
    }
}

ACTOR PlasmaCannonBeamTrailInheritor
{
    Radius 2
    Height 2
    Scale 1.5
    Speed 0
    Damage 0
    Projectile
    RenderStyle Add
    Alpha 1
}

ACTOR PlasmaCannonCellBeamTrail : PlasmaCannonBeamTrailInheritor
{
    States
    {
        Spawn:
            ENBG AJKL 2
            Stop
    }
}

ACTOR PlasmaCannonLunariumBeamTrail : PlasmaCannonBeamTrailInheritor
{
    States
    {
        Spawn:
            ENBB AJKL 2
            Stop
    }
}

ACTOR PlasmaCannonSolariumBeamTrail : PlasmaCannonBeamTrailInheritor
{
    States
    {
        Spawn:
            ENBR AJKL 2
            Stop
    }
}